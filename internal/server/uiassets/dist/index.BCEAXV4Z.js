var ge,k,ft,pn,Z,ct,pt,ht,mt,Fe,Pe,Le,hn,ie={},vt=[],mn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ye=Array.isArray;function M(t,e){for(var n in e)t[n]=e[n];return t}function He(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function vn(t,e,n){var r,_,i,u={};for(i in e)i=="key"?r=e[i]:i=="ref"?_=e[i]:u[i]=e[i];if(arguments.length>2&&(u.children=arguments.length>3?ge.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)u[i]===void 0&&(u[i]=t.defaultProps[i]);return me(t,u,r,_,null)}function me(t,e,n,r,_){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:_??++ft,__i:-1,__u:0};return _==null&&k.vnode!=null&&k.vnode(i),i}function oe(t){return t.children}function ve(t,e){this.props=t,this.context=e}function ne(t,e){if(e==null)return t.__?ne(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?ne(t):null}function bt(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return bt(t)}}function ut(t){(!t.__d&&(t.__d=!0)&&Z.push(t)&&!be.__r++||ct!=k.debounceRendering)&&((ct=k.debounceRendering)||pt)(be)}function be(){for(var t,e,n,r,_,i,u,f=1;Z.length;)Z.length>f&&Z.sort(ht),t=Z.shift(),f=Z.length,t.__d&&(n=void 0,r=void 0,_=(r=(e=t).__v).__e,i=[],u=[],e.__P&&((n=M({},r)).__v=r.__v+1,k.vnode&&k.vnode(n),Re(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[_]:null,i,_??ne(r),!!(32&r.__u),u),n.__v=r.__v,n.__.__k[n.__i]=n,kt(i,n,u),r.__e=r.__=null,n.__e!=_&&bt(n)));be.__r=0}function gt(t,e,n,r,_,i,u,f,c,d,b){var l,m,v,C,A,N,g,y=r&&r.__k||vt,P=e.length;for(c=bn(n,e,y,c,P),l=0;l<P;l++)(v=n.__k[l])!=null&&(m=v.__i==-1?ie:y[v.__i]||ie,v.__i=l,N=Re(t,v,m,_,i,u,f,c,d,b),C=v.__e,v.ref&&m.ref!=v.ref&&(m.ref&&Ue(m.ref,null,v),b.push(v.ref,v.__c||C,v)),A==null&&C!=null&&(A=C),(g=!!(4&v.__u))||m.__k===v.__k?c=yt(v,c,t,g):typeof v.type=="function"&&N!==void 0?c=N:C&&(c=C.nextSibling),v.__u&=-7);return n.__e=A,c}function bn(t,e,n,r,_){var i,u,f,c,d,b=n.length,l=b,m=0;for(t.__k=new Array(_),i=0;i<_;i++)(u=e[i])!=null&&typeof u!="boolean"&&typeof u!="function"?(c=i+m,(u=t.__k[i]=typeof u=="string"||typeof u=="number"||typeof u=="bigint"||u.constructor==String?me(null,u,null,null,null):ye(u)?me(oe,{children:u},null,null,null):u.constructor==null&&u.__b>0?me(u.type,u.props,u.key,u.ref?u.ref:null,u.__v):u).__=t,u.__b=t.__b+1,f=null,(d=u.__i=gn(u,n,c,l))!=-1&&(l--,(f=n[d])&&(f.__u|=2)),f==null||f.__v==null?(d==-1&&(_>b?m--:_<b&&m++),typeof u.type!="function"&&(u.__u|=4)):d!=c&&(d==c-1?m--:d==c+1?m++:(d>c?m--:m++,u.__u|=4))):t.__k[i]=null;if(l)for(i=0;i<b;i++)(f=n[i])!=null&&(2&f.__u)==0&&(f.__e==r&&(r=ne(f)),St(f,f));return r}function yt(t,e,n,r){var _,i;if(typeof t.type=="function"){for(_=t.__k,i=0;_&&i<_.length;i++)_[i]&&(_[i].__=t,e=yt(_[i],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=ne(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function gn(t,e,n,r){var _,i,u,f=t.key,c=t.type,d=e[n],b=d!=null&&(2&d.__u)==0;if(d===null&&t.key==null||b&&f==d.key&&c==d.type)return n;if(r>(b?1:0)){for(_=n-1,i=n+1;_>=0||i<e.length;)if((d=e[u=_>=0?_--:i++])!=null&&(2&d.__u)==0&&f==d.key&&c==d.type)return u}return-1}function _t(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||mn.test(e)?n:n+"px"}function he(t,e,n,r,_){var i,u;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||_t(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||_t(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(mt,"$1")),u=e.toLowerCase(),e=u in t||e=="onFocusOut"||e=="onFocusIn"?u.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=Fe,t.addEventListener(e,i?Le:Pe,i)):t.removeEventListener(e,i?Le:Pe,i);else{if(_=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function dt(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Fe++;else if(e.t<n.u)return;return n(k.event?k.event(e):e)}}}function Re(t,e,n,r,_,i,u,f,c,d){var b,l,m,v,C,A,N,g,y,P,F,K,O,V,T,B,J,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),i=[f=e.__e=n.__e]),(b=k.__b)&&b(e);e:if(typeof L=="function")try{if(g=e.props,y="prototype"in L&&L.prototype.render,P=(b=L.contextType)&&r[b.__c],F=b?P?P.props.value:b.__:r,n.__c?N=(l=e.__c=n.__c).__=l.__E:(y?e.__c=l=new L(g,F):(e.__c=l=new ve(g,F),l.constructor=L,l.render=kn),P&&P.sub(l),l.props=g,l.state||(l.state={}),l.context=F,l.__n=r,m=l.__d=!0,l.__h=[],l._sb=[]),y&&l.__s==null&&(l.__s=l.state),y&&L.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=M({},l.__s)),M(l.__s,L.getDerivedStateFromProps(g,l.__s))),v=l.props,C=l.state,l.__v=e,m)y&&L.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),y&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(y&&L.getDerivedStateFromProps==null&&g!==v&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(g,F),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(g,l.__s,F)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(l.props=g,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(H){H&&(H.__=e)}),K=0;K<l._sb.length;K++)l.__h.push(l._sb[K]);l._sb=[],l.__h.length&&u.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(g,l.__s,F),y&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(v,C,A)})}if(l.context=F,l.props=g,l.__P=t,l.__e=!1,O=k.__r,V=0,y){for(l.state=l.__s,l.__d=!1,O&&O(e),b=l.render(l.props,l.state,l.context),T=0;T<l._sb.length;T++)l.__h.push(l._sb[T]);l._sb=[]}else do l.__d=!1,O&&O(e),b=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++V<25);l.state=l.__s,l.getChildContext!=null&&(r=M(M({},r),l.getChildContext())),y&&!m&&l.getSnapshotBeforeUpdate!=null&&(A=l.getSnapshotBeforeUpdate(v,C)),B=b,b!=null&&b.type===oe&&b.key==null&&(B=wt(b.props.children)),f=gt(t,ye(B)?B:[B],e,n,r,_,i,u,f,c,d),l.base=e.__e,e.__u&=-161,l.__h.length&&u.push(l),N&&(l.__E=l.__=null)}catch(H){if(e.__v=null,c||i!=null)if(H.then){for(e.__u|=c?160:128;f&&f.nodeType==8&&f.nextSibling;)f=f.nextSibling;i[i.indexOf(f)]=null,e.__e=f}else{for(J=i.length;J--;)He(i[J]);$e(e)}else e.__e=n.__e,e.__k=n.__k,H.then||$e(e);k.__e(H,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):f=e.__e=yn(n.__e,e,n,r,_,i,u,c,d);return(b=k.diffed)&&b(e),128&e.__u?void 0:f}function $e(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach($e)}function kt(t,e,n){for(var r=0;r<n.length;r++)Ue(n[r],n[++r],n[++r]);k.__c&&k.__c(e,t),t.some(function(_){try{t=_.__h,_.__h=[],t.some(function(i){i.call(_)})}catch(i){k.__e(i,_.__v)}})}function wt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ye(t)?t.map(wt):M({},t)}function yn(t,e,n,r,_,i,u,f,c){var d,b,l,m,v,C,A,N=n.props,g=e.props,y=e.type;if(y=="svg"?_="http://www.w3.org/2000/svg":y=="math"?_="http://www.w3.org/1998/Math/MathML":_||(_="http://www.w3.org/1999/xhtml"),i!=null){for(d=0;d<i.length;d++)if((v=i[d])&&"setAttribute"in v==!!y&&(y?v.localName==y:v.nodeType==3)){t=v,i[d]=null;break}}if(t==null){if(y==null)return document.createTextNode(g);t=document.createElementNS(_,y,g.is&&g),f&&(k.__m&&k.__m(e,i),f=!1),i=null}if(y==null)N===g||f&&t.data==g||(t.data=g);else{if(i=i&&ge.call(t.childNodes),N=n.props||ie,!f&&i!=null)for(N={},d=0;d<t.attributes.length;d++)N[(v=t.attributes[d]).name]=v.value;for(d in N)if(v=N[d],d!="children"){if(d=="dangerouslySetInnerHTML")l=v;else if(!(d in g)){if(d=="value"&&"defaultValue"in g||d=="checked"&&"defaultChecked"in g)continue;he(t,d,null,v,_)}}for(d in g)v=g[d],d=="children"?m=v:d=="dangerouslySetInnerHTML"?b=v:d=="value"?C=v:d=="checked"?A=v:f&&typeof v!="function"||N[d]===v||he(t,d,v,N[d],_);if(b)f||l&&(b.__html==l.__html||b.__html==t.innerHTML)||(t.innerHTML=b.__html),e.__k=[];else if(l&&(t.innerHTML=""),gt(e.type=="template"?t.content:t,ye(m)?m:[m],e,n,r,y=="foreignObject"?"http://www.w3.org/1999/xhtml":_,i,u,i?i[0]:n.__k&&ne(n,0),f,c),i!=null)for(d=i.length;d--;)He(i[d]);f||(d="value",y=="progress"&&C==null?t.removeAttribute("value"):C!=null&&(C!==t[d]||y=="progress"&&!C||y=="option"&&C!=N[d])&&he(t,d,C,N[d],_),d="checked",A!=null&&A!=t[d]&&he(t,d,A,N[d],_))}return t}function Ue(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(_){k.__e(_,n)}}function St(t,e,n){var r,_;if(k.unmount&&k.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||Ue(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){k.__e(i,e)}r.base=r.__P=null}if(r=t.__k)for(_=0;_<r.length;_++)r[_]&&St(r[_],e,n||typeof t.type!="function");n||He(t.__e),t.__c=t.__=t.__e=void 0}function kn(t,e,n){return this.constructor(t,n)}function Nt(t,e,n){var r,_,i,u;e==document&&(e=document.documentElement),k.__&&k.__(t,e),_=(r=typeof n=="function")?null:n&&n.__k||e.__k,i=[],u=[],Re(e,t=(!r&&n||e).__k=vn(oe,null,[t]),_||ie,ie,e.namespaceURI,!r&&n?[n]:_?null:e.firstChild?ge.call(e.childNodes):null,i,!r&&n?n:_?_.__e:e.firstChild,r,u),kt(i,t,u)}ge=vt.slice,k={__e:function(t,e,n,r){for(var _,i,u;e=e.__;)if((_=e.__c)&&!_.__)try{if((i=_.constructor)&&i.getDerivedStateFromError!=null&&(_.setState(i.getDerivedStateFromError(t)),u=_.__d),_.componentDidCatch!=null&&(_.componentDidCatch(t,r||{}),u=_.__d),u)return _.__E=_}catch(f){t=f}throw t}},ft=0,pn=function(t){return t!=null&&t.constructor==null},ve.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=M({},this.state),typeof t=="function"&&(t=t(M({},n),this.props)),t&&M(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ut(this))},ve.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ut(this))},ve.prototype.render=oe,Z=[],pt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ht=function(t,e){return t.__v.__b-e.__v.__b},be.__r=0,mt=/(PointerCapture)$|Capture$/i,Fe=0,Pe=dt(!1),Le=dt(!0),hn=0;var le,x,je,Tt,we=0,Lt=[],E=k,Ct=E.__b,xt=E.__r,Et=E.diffed,Dt=E.__c,At=E.unmount,It=E.__;function Oe(t,e){E.__h&&E.__h(x,t,we||e),we=0;var n=x.__H||(x.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function w(t){return we=1,wn(Ht,t)}function wn(t,e,n){var r=Oe(le++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):Ht(void 0,e),function(f){var c=r.__N?r.__N[0]:r.__[0],d=r.t(c,f);c!==d&&(r.__N=[d,r.__[1]],r.__c.setState({}))}],r.__c=x,!x.__f)){var _=function(f,c,d){if(!r.__c.__H)return!0;var b=r.__c.__H.__.filter(function(m){return!!m.__c});if(b.every(function(m){return!m.__N}))return!i||i.call(this,f,c,d);var l=r.__c.props!==f;return b.forEach(function(m){if(m.__N){var v=m.__[0];m.__=m.__N,m.__N=void 0,v!==m.__[0]&&(l=!0)}}),i&&i.call(this,f,c,d)||l};x.__f=!0;var i=x.shouldComponentUpdate,u=x.componentWillUpdate;x.componentWillUpdate=function(f,c,d){if(this.__e){var b=i;i=void 0,_(f,c,d),i=b}u&&u.call(this,f,c,d)},x.shouldComponentUpdate=_}return r.__N||r.__}function $(t,e){var n=Oe(le++,3);!E.__s&&Ft(n.__H,e)&&(n.__=t,n.u=e,x.__H.__h.push(n))}function $t(t){return we=5,Se(function(){return{current:t}},[])}function Se(t,e){var n=Oe(le++,7);return Ft(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Sn(){for(var t;t=Lt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ke),t.__H.__h.forEach(Me),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){x=null,Ct&&Ct(t)},E.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),It&&It(t,e)},E.__r=function(t){xt&&xt(t),le=0;var e=(x=t.__c).__H;e&&(je===x?(e.__h=[],x.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(ke),e.__h.forEach(Me),e.__h=[],le=0)),je=x},E.diffed=function(t){Et&&Et(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Lt.push(e)!==1&&Tt===E.requestAnimationFrame||((Tt=E.requestAnimationFrame)||Nn)(Sn)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),je=x=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ke),n.__h=n.__h.filter(function(r){return!r.__||Me(r)})}catch(r){e.some(function(_){_.__h&&(_.__h=[])}),e=[],E.__e(r,n.__v)}}),Dt&&Dt(t,e)},E.unmount=function(t){At&&At(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{ke(r)}catch(_){e=_}}),n.__H=void 0,e&&E.__e(e,n.__v))};var Pt=typeof requestAnimationFrame=="function";function Nn(t){var e,n=function(){clearTimeout(r),Pt&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Pt&&(e=requestAnimationFrame(n))}function ke(t){var e=x,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),x=e}function Me(t){var e=x;t.__c=t.__(),x=e}function Ft(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Ht(t,e){return typeof e=="function"?e(t):e}function Tn(){let t=localStorage.getItem("grns_api_token");return t?{Authorization:`Bearer ${t}`}:{}}async function W(t,e,n){let r={...Tn()},_={method:t,headers:r};n!==void 0&&(r["Content-Type"]="application/json",_.body=JSON.stringify(n));let i=await fetch(`${e}`,_);if(!i.ok){let u=await i.json().catch(()=>({})),f=u.error||i.statusText,c=new Error(f);throw c.status=i.status,c.code=u.code,c.errorCode=u.error_code,c}return i.status===204?null:i.json()}function Rt(){return W("GET","/v1/info")}function Be(t,e={}){let n=new URLSearchParams(e);return W("GET",`/v1/projects/${encodeURIComponent(t)}/tasks?${n.toString()}`)}function We(t,e){return W("GET",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}`)}function Ut(t,e,n){return W("PATCH",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}`,n)}function Ke(t,e,n){return W("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}/labels`,{labels:n})}function jt(t,e,n){return W("DELETE",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}/labels`,{labels:n})}function Ve(t,e){return W("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/close`,{ids:e})}function qe(t,e){return W("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/reopen`,{ids:e})}var Cn=0,Wn=Array.isArray;function o(t,e,n,r,_,i){e||(e={});var u,f,c=e;if("ref"in c)for(f in c={},e)f=="ref"?u=e[f]:c[f]=e[f];var d={type:t,props:c,key:n,ref:u,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Cn,__i:-1,__u:0,__source:_,__self:i};if(typeof t=="function"&&(u=t.defaultProps))for(f in u)c[f]===void 0&&(c[f]=u[f]);return k.vnode&&k.vnode(d),d}var ce=["open","in_progress","blocked","deferred","pinned","closed","tombstone"],xn=["bug","feature","task","epic","chore"],En=[0,1,2,3,4],Mt=["open","in_progress","blocked","deferred","pinned"],Dn=[20,50,100],Ot=50;function An(t){let e=t||"#/";e.startsWith("#")&&(e=e.slice(1)),e.startsWith("/")||(e=`/${e}`);let[n,r=""]=e.split("?");return{path:n||"/",params:new URLSearchParams(r)}}function Ne(t,e){let n=e.toString();return`#${t}${n?`?${n}`:""}`}function ze(t){let e=new Set(t);return ce.filter(n=>e.has(n))}function In(t){let e=(t.get("search")||"").trim(),n=(t.get("status")||"").split(",").map(c=>c.trim()).filter(Boolean),r=ze(n),_=Number.parseInt(t.get("limit")||"",10),i=Number.isFinite(_)&&_>0?_:Ot,u=Number.parseInt(t.get("offset")||"",10),f=Number.isFinite(u)&&u>=0?u:0;return{search:e,statuses:r.length>0?r:Mt,limit:i,offset:f}}function Pn(t){return t.startsWith("/tasks/")?t.slice(7).split("/")[0].trim():""}function Ln(){let[t,e]=w(window.location.hash||"#/");return $(()=>{let n=()=>e(window.location.hash||"#/");return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),t}function $n(t,e){let[n,r]=w(t);return $(()=>{let _=window.setTimeout(()=>r(t),e);return()=>window.clearTimeout(_)},[t,e]),n}function Te(t){if(!t)return"\u2014";let e=new Date(t);return Number.isNaN(e.getTime())?t:e.toISOString().slice(0,19)+"Z"}function Fn(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}function Hn(t){return t instanceof Element?!!t.closest('input, textarea, select, button, [contenteditable="true"]'):!1}function Ge(){let t=Ln(),e=Se(()=>An(t),[t]),n=Se(()=>In(e.params),[e]),r=$n(n.search,300),[_,i]=w(null),[u,f]=w([]),[c,d]=w(null),[b,l]=w(!0),[m,v]=w(!1),[C,A]=w(!1),[N,g]=w(""),[y,P]=w(""),[F,K]=w(""),[O,V]=w(""),[T,B]=w(""),[J,L]=w(""),[H,Ce]=w(""),[Bt,xe]=w(""),[Ze,ue]=w(""),[R,Y]=w([]),[Je,Ye]=w(""),[Qe,q]=w(""),[Xe,z]=w(""),[U,Q]=w(!1),[_e,X]=w(0),[de,G]=w(!1),fe=$t(null),S=(e.params.get("project")||"").trim()||_?.project_prefix||"",j=e.path==="/",se=Pn(e.path),Ee=se!=="";$(()=>{let s=!0;async function a(){l(!0),g("");try{let p=await Rt();if(!s)return;i(p)}catch(p){if(!s)return;g(p.message||"Failed to load server info")}finally{s&&l(!1)}}return a(),()=>{s=!1}},[]);function et(){let s={limit:String(n.limit),offset:String(n.offset),status:n.statuses.join(",")};return r&&(s.search=r),s}async function De(){if(!j||!S)return!1;v(!0),P("");try{let s=await Be(S,et());return f(s),!0}catch(s){return P(s.message||"Failed to load tasks"),!1}finally{v(!1)}}$(()=>{if(!j||!S)return;let s=!0;return v(!0),P(""),Be(S,et()).then(a=>{s&&f(a)}).catch(a=>{s&&P(a.message||"Failed to load tasks")}).finally(()=>{s&&v(!1)}),()=>{s=!1}},[S,j,n.limit,n.offset,n.statuses,r]),$(()=>{let s=!0;async function a(){if(!Ee||!S){d(null);return}A(!0),K(""),V("");try{let p=await We(S,se);if(!s)return;d(p)}catch(p){if(!s)return;d(null),K(p.message||"Failed to load task")}finally{s&&A(!1)}}return a(),()=>{s=!1}},[S,Ee,se]),$(()=>{Y(s=>{let a=new Set(u.map(p=>p.id));return s.filter(p=>a.has(p))}),X(s=>u.length===0?0:Math.min(s,u.length-1))},[u]),$(()=>{L(c?.assignee||"")},[c?.id,c?.assignee]),$(()=>{Ce("")},[c?.id]),$(()=>{xe(""),ue("")},[c?.id]),$(()=>{j||G(!1)},[j]);function re(s){if(!j)return;let a=new URLSearchParams(e.params),p=(s.search||"").trim();p?a.set("search",p):a.delete("search");let h=ze(s.statuses);h.length>0&&!Fn(h,Mt)?a.set("status",h.join(",")):a.delete("status"),s.limit>0&&s.limit!==Ot?a.set("limit",String(s.limit)):a.delete("limit"),s.offset>0?a.set("offset",String(s.offset)):a.delete("offset");let D=Ne("/",a);window.location.hash!==D&&(window.location.hash=D)}function Wt(s){let a=n.statuses.includes(s)?n.statuses.filter(h=>h!==s):[...n.statuses,s],p=ze(a);re({...n,statuses:p.length>0?p:ce,offset:0})}function Kt(s){re({...n,search:s.currentTarget.value,offset:0})}function Vt(s){let a=Number.parseInt(s.currentTarget.value,10);!Number.isFinite(a)||a<=0||re({...n,limit:a,offset:0})}function qt(){re({...n,offset:Math.max(0,n.offset-n.limit)})}function zt(){re({...n,offset:n.offset+n.limit})}function Gt(){if(u.length===0)return;let s=Math.min(_e,u.length-1),a=u[s]?.id;if(!a)return;let p=Ne(`/tasks/${a}`,e.params);window.location.hash!==p&&(window.location.hash=p)}function tt(s){Y(a=>{let p=new Set(a);return p.has(s)?p.delete(s):p.add(s),Array.from(p)})}function nt(){let s=u.map(h=>h.id);if(s.length===0)return;let a=new Set(R),p=s.every(h=>a.has(h));Y(h=>{let D=new Set(h);return p?s.forEach(I=>D.delete(I)):s.forEach(I=>D.add(I)),Array.from(D)})}function Zt(){Y([])}async function Jt(){if(!S||R.length===0)return;let s=[...R];Q(!0),q(""),z("");try{await Ve(S,s);let a=await De();Y([]),z(a?`Closed ${s.length} task(s).`:`Closed ${s.length} task(s), but refresh failed.`)}catch(a){q(a.message||"Failed to close selected tasks")}finally{Q(!1)}}async function Yt(){if(!S||R.length===0)return;let s=[...R];Q(!0),q(""),z("");try{await qe(S,s);let a=await De();Y([]),z(a?`Reopened ${s.length} task(s).`:`Reopened ${s.length} task(s), but refresh failed.`)}catch(a){q(a.message||"Failed to reopen selected tasks")}finally{Q(!1)}}async function ot(){if(!S||R.length===0)return;let s=at(Je);if(s.length===0)return;let a=[...R];Q(!0),q(""),z("");try{let p=await Promise.allSettled(a.map(I=>Ke(S,I,s))),h=p.filter(I=>I.status==="fulfilled").length,D=p.length-h;if(h>0){let I=await De();Ye(""),z(I?`Added label(s) to ${h}/${a.length} task(s).`:`Added label(s) to ${h}/${a.length} task(s), but refresh failed.`)}else z(`Added label(s) to ${h}/${a.length} task(s).`);if(D>0){let I=p.find(fn=>fn.status==="rejected"),dn=I&&I.reason?String(I.reason.message||I.reason):"unknown error";q(`Failed on ${D} task(s): ${dn}`)}}catch(p){q(p.message||"Failed to add labels to selected tasks")}finally{Q(!1)}}async function ae(s,a,p){V(""),B(s);try{return await a()}catch(h){return V(h.message||p||`Failed to update ${s}`),null}finally{B("")}}async function st(){if(!S||!se)return null;let s=await We(S,se);return d(s),s}async function ee(s,a){if(!S||!c||!c.id)return!1;let p=await ae(s,()=>Ut(S,c.id,a),`Failed to update ${s}`);return p?(d(p),!0):!1}function Qt(s){let a=s.currentTarget.value;!c||a===c.status||ee("status",{status:a})}function Xt(s){let a=s.currentTarget.value;!c||a===c.type||ee("type",{type:a})}function en(s){let a=Number.parseInt(s.currentTarget.value,10);!c||!Number.isFinite(a)||a===c.priority||ee("priority",{priority:a})}function rt(){if(!c)return;let s=J.trim(),a=(c.assignee||"").trim();s!==a&&ee("assignee",{assignee:s})}function at(s){let a=s.split(",").map(p=>p.trim().toLowerCase()).filter(Boolean);return Array.from(new Set(a))}async function it(){if(!c||!c.id)return;let s=at(H);if(s.length===0)return;let a=await ae("labels",()=>Ke(S,c.id,s),"Failed to add labels");a&&(d(p=>p&&{...p,labels:a}),Ce(""))}async function tn(s){if(!c||!c.id)return;let a=await ae("labels",()=>jt(S,c.id,[s]),"Failed to remove label");a&&d(p=>p&&{...p,labels:a})}async function nn(){if(!c||!c.id)return;await ae("close",()=>Ve(S,[c.id]),"Failed to close task")&&await st()}async function on(){if(!c||!c.id)return;await ae("reopen",()=>qe(S,[c.id]),"Failed to reopen task")&&await st()}function sn(){c&&c.status!=="tombstone"&&ee("status",{status:"tombstone"})}function rn(s){c&&(V(""),xe(s),ue(c[s]||""))}function Ae(){xe(""),ue("")}async function an(s){if(!c)return;let a=Ze,p=c[s]||"";if(a===p){Ae();return}await ee(s,{[s]:a})&&Ae()}function pe(s,a){if(!c)return null;let p=Bt===a,h=c[a]||"";return o("div",{className:"detail-section",children:[o("div",{className:"detail-section-header",children:[o("h3",{children:s}),p?o("div",{className:"inline-actions",children:[o("button",{type:"button",onClick:()=>an(a),disabled:T!=="",children:"Save"}),o("button",{type:"button",onClick:Ae,disabled:T!=="",children:"Cancel"})]}):o("button",{type:"button",className:"detail-edit-btn",onClick:()=>rn(a),disabled:T!=="",children:"Edit"})]}),p?o("textarea",{className:"detail-textarea",value:Ze,onInput:D=>ue(D.currentTarget.value),rows:6,disabled:T!==""}):o("pre",{children:h||"\u2014"})]})}$(()=>{if(!j)return;function s(a){if(!(a.defaultPrevented||a.metaKey||a.ctrlKey||a.altKey)){if(a.key==="Escape"&&de){a.preventDefault(),G(!1);return}if(!Hn(a.target)){if(a.key==="?"||a.shiftKey&&a.key==="/"){a.preventDefault(),G(p=>!p);return}if(a.key==="/"&&!a.shiftKey){a.preventDefault(),fe.current&&(fe.current.focus(),fe.current.select());return}if(!de&&!(m||U)){if(a.shiftKey&&a.key.toLowerCase()==="a"){a.preventDefault(),nt();return}if(!a.shiftKey&&(a.key==="x"||a.key==="X")){if(a.preventDefault(),u.length===0)return;let p=Math.min(_e,u.length-1),h=u[p]?.id||u[0]?.id;h&&tt(h);return}if(a.key==="Enter"){a.preventDefault(),Gt();return}if(a.key==="ArrowDown"||a.key==="j"){if(a.preventDefault(),u.length===0)return;X(p=>Math.min(p+1,u.length-1));return}if(a.key==="ArrowUp"||a.key==="k"){if(a.preventDefault(),u.length===0)return;X(p=>Math.max(p-1,0))}}}}}return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[j,u,_e,m,U,de,e.params]);let ln=Math.floor(n.offset/n.limit)+1,cn=n.offset>0,un=u.length===n.limit,Ie=new Set(R),te=R.length,_n=u.length>0&&u.every(s=>Ie.has(s.id)),lt=ce.map(s=>({status:s,count:u.reduce((a,p)=>Ie.has(p.id)&&p.status===s?a+1:a,0)})).filter(s=>s.count>0);if(Ee){let s=c?.labels||[],a=c?.deps||[],p=Ne("/",e.params);return o("main",{className:"container",children:[o("header",{className:"header",children:[o("h1",{children:"Task detail"}),o("div",{className:"meta",children:b?"Loading server info\u2026":`project: ${S||"\u2014"}`})]}),o("a",{className:"back-link",href:p,children:"\u2190 Back to task list"}),C&&o("div",{className:"meta",children:"Loading task\u2026"}),!C&&c&&o("section",{className:"detail-card",children:[o("h2",{children:c.title}),o("div",{className:"detail-id mono",children:c.id}),T&&o("div",{className:"meta",children:["Saving ",T,"\u2026"]}),o("div",{className:"detail-grid",children:[o("div",{children:[o("strong",{children:"Status:"})," ",o("select",{value:c.status,onChange:Qt,disabled:T!=="",children:ce.map(h=>o("option",{value:h,children:h},h))})]}),o("div",{children:[o("strong",{children:"Type:"})," ",o("select",{value:c.type,onChange:Xt,disabled:T!=="",children:xn.map(h=>o("option",{value:h,children:h},h))})]}),o("div",{children:[o("strong",{children:"Priority:"})," ",o("select",{value:String(c.priority),onChange:en,disabled:T!=="",children:En.map(h=>o("option",{value:String(h),children:h},h))})]}),o("div",{className:"assignee-edit",children:[o("strong",{children:"Assignee:"})," ",o("input",{type:"text",value:J,onInput:h=>L(h.currentTarget.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),rt())},placeholder:"unassigned",disabled:T!==""}),o("button",{type:"button",onClick:rt,disabled:T!=="",children:"Save"})]}),o("div",{children:[o("strong",{children:"Parent:"})," ",c.parent_id?o("a",{href:`#/tasks/${c.parent_id}`,children:c.parent_id}):"\u2014"]}),o("div",{children:[o("strong",{children:"Spec:"})," ",c.spec_id||"\u2014"]}),o("div",{children:[o("strong",{children:"Created:"})," ",o("span",{className:"mono small",children:Te(c.created_at)})]}),o("div",{children:[o("strong",{children:"Updated:"})," ",o("span",{className:"mono small",children:Te(c.updated_at)})]}),o("div",{children:[o("strong",{children:"Closed:"})," ",o("span",{className:"mono small",children:Te(c.closed_at)})]})]}),o("div",{className:"detail-section",children:[o("div",{className:"detail-section-header",children:o("h3",{children:"Labels"})}),s.length===0?o("div",{className:"meta",children:"No labels."}):o("div",{className:"label-row",children:s.map(h=>o("span",{className:"label-chip",children:[h,o("button",{type:"button",className:"label-remove-btn",onClick:()=>tn(h),disabled:T!=="","aria-label":`Remove label ${h}`,children:"\xD7"})]},h))}),o("div",{className:"label-add-row",children:[o("input",{type:"text",value:H,onInput:h=>Ce(h.currentTarget.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),it())},placeholder:"add labels (comma-separated)",disabled:T!==""}),o("button",{type:"button",onClick:it,disabled:T!=="",children:"Add"})]})]}),pe("Description","description"),pe("Notes","notes"),pe("Acceptance criteria","acceptance_criteria"),pe("Design","design"),o("div",{className:"detail-section",children:[o("h3",{children:"Dependencies"}),a.length===0?o("div",{className:"meta",children:"No direct dependencies."}):o("ul",{className:"dep-list",children:a.map(h=>o("li",{children:[o("a",{href:`#/tasks/${h.parent_id}`,children:h.parent_id})," ",o("span",{className:"meta",children:["(",h.type,")"]})]},`${h.parent_id}-${h.type}`))})]}),o("div",{className:"detail-section",children:[o("h3",{children:"Actions"}),o("div",{className:"action-row",children:[o("button",{type:"button",onClick:nn,disabled:T!==""||c.status==="closed"||c.status==="tombstone",children:"Close"}),o("button",{type:"button",onClick:on,disabled:T!==""||c.status!=="closed"&&c.status!=="tombstone",children:"Reopen"}),o("button",{type:"button",onClick:sn,disabled:T!==""||c.status==="tombstone",children:"Mark tombstone"})]})]})]}),O&&o("div",{className:"error",children:O}),F&&o("div",{className:"error",children:F}),N&&o("div",{className:"error",children:N})]})}return j?o("main",{className:"container",children:[o("header",{className:"header",children:[o("h1",{children:"Task list"}),o("div",{className:"meta",children:b?"Loading server info\u2026":`project: ${S||"\u2014"} \xB7 schema: ${_?.schema_version??"\u2014"}`})]}),o("section",{className:"controls",children:[o("label",{className:"search",children:[o("span",{children:"Search"}),o("input",{ref:fe,type:"search",value:n.search,onInput:Kt,placeholder:"Search title/description/notes"})]}),o("div",{className:"status-row",children:ce.map(s=>{let a=n.statuses.includes(s);return o("button",{type:"button",className:`status-chip ${a?"active":""}`,onClick:()=>Wt(s),children:s},s)})})]}),o("section",{className:"list-meta",children:[o("div",{children:[m?"Loading tasks\u2026":`Showing ${u.length} task(s)`,r&&o("span",{children:[" \xB7 search: \u201C",r,"\u201D"]})]}),o("label",{children:["Page size",o("select",{value:String(n.limit),onChange:Vt,children:Dn.map(s=>o("option",{value:String(s),children:s},s))})]})]}),o("section",{className:"bulk-actions",children:[o("div",{className:"bulk-summary-row",children:[o("div",{className:"bulk-summary",children:["Selected: ",te]}),o("div",{className:"bulk-summary-actions",children:[o("button",{type:"button",onClick:()=>G(!0),children:"Shortcuts (?)"}),o("button",{type:"button",onClick:Zt,disabled:te===0||U||m,children:"Clear selection"})]})]}),o("div",{className:"bulk-shortcuts",children:"Shortcuts: ? help \xB7 / search \xB7 Enter open active \xB7 x toggle active \xB7 Shift+A select visible \xB7 j/k move active"}),lt.length>0&&o("div",{className:"bulk-status-counts",children:lt.map(s=>o("span",{className:"bulk-status-chip",children:[s.status,": ",s.count]},s.status))}),o("div",{className:"bulk-controls",children:[o("button",{type:"button",onClick:Jt,disabled:te===0||U||m,children:"Close selected"}),o("button",{type:"button",onClick:Yt,disabled:te===0||U||m,children:"Reopen selected"}),o("input",{type:"text",value:Je,onInput:s=>Ye(s.currentTarget.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),ot())},placeholder:"labels for selected (comma-separated)",disabled:te===0||U||m}),o("button",{type:"button",onClick:ot,disabled:te===0||U||m,children:"Add labels"})]})]}),o("section",{children:o("table",{className:"task-table",children:[o("thead",{children:o("tr",{children:[o("th",{children:o("input",{type:"checkbox",checked:_n,onChange:nt,"aria-label":"Select all visible tasks",disabled:u.length===0||m||U})}),o("th",{children:"ID"}),o("th",{children:"Title"}),o("th",{children:"Status"}),o("th",{children:"Priority"}),o("th",{children:"Type"}),o("th",{children:"Updated"})]})}),o("tbody",{children:[u.map((s,a)=>{let p=Ne(`/tasks/${s.id}`,e.params);return o("tr",{className:a===_e?"row-active":"",onClick:()=>X(a),children:[o("td",{children:o("input",{type:"checkbox",checked:Ie.has(s.id),onChange:()=>{X(a),tt(s.id)},onClick:D=>D.stopPropagation(),"aria-label":`Select task ${s.id}`,disabled:m||U})}),o("td",{className:"mono",children:s.id}),o("td",{children:o("a",{href:p,onClick:D=>{D.stopPropagation(),X(a)},children:s.title})}),o("td",{children:s.status}),o("td",{children:s.priority}),o("td",{children:s.type}),o("td",{className:"mono small",children:Te(s.updated_at)})]},s.id)}),!m&&u.length===0&&o("tr",{children:o("td",{colSpan:7,className:"empty",children:"No tasks found for current filters."})})]})]})}),o("section",{className:"pagination",children:[o("button",{type:"button",onClick:qt,disabled:!cn||m,children:"\u2190 Prev"}),o("span",{children:["Page ",ln]}),o("button",{type:"button",onClick:zt,disabled:!un||m,children:"Next \u2192"})]}),de&&o("div",{className:"shortcut-overlay",onClick:()=>G(!1),role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Escape"||s.key==="Enter"||s.key===" ")&&(s.preventDefault(),G(!1))},children:o("div",{className:"shortcut-modal",onClick:s=>s.stopPropagation(),children:[o("div",{className:"shortcut-modal-header",children:[o("h3",{children:"Keyboard shortcuts"}),o("button",{type:"button",onClick:()=>G(!1),children:"Close"})]}),o("ul",{children:[o("li",{children:[o("kbd",{children:"?"})," toggle shortcut help"]}),o("li",{children:[o("kbd",{children:"/"})," focus search"]}),o("li",{children:[o("kbd",{children:"Enter"})," open active row"]}),o("li",{children:[o("kbd",{children:"j"}),"/",o("kbd",{children:"k"})," or ",o("kbd",{children:"\u2193"}),"/",o("kbd",{children:"\u2191"})," move active row"]}),o("li",{children:[o("kbd",{children:"x"})," toggle selection for active row"]}),o("li",{children:[o("kbd",{children:"Shift"}),"+",o("kbd",{children:"A"})," select/unselect all visible"]}),o("li",{children:[o("kbd",{children:"Esc"})," close this dialog"]})]})]})}),Xe&&o("div",{className:"meta",children:Xe}),Qe&&o("div",{className:"error",children:Qe}),y&&o("div",{className:"error",children:y}),N&&o("div",{className:"error",children:N})]}):o("main",{className:"container",children:[o("h1",{children:"grns web ui"}),o("div",{className:"meta",children:["Route scaffold active: ",e.path]}),o("a",{href:"#/",children:"Back to task list"})]})}Nt(o(Ge,{}),document.getElementById("app"));
