var Ne,w,At,Rn,Z,Tt,It,Pt,Lt,Be,Ue,je,Hn,le={},$t=[],Un=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ce=Array.isArray;function q(t,e){for(var n in e)t[n]=e[n];return t}function Oe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function jn(t,e,n){var a,_,i,u={};for(i in e)i=="key"?a=e[i]:i=="ref"?_=e[i]:u[i]=e[i];if(arguments.length>2&&(u.children=arguments.length>3?Ne.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)u[i]===void 0&&(u[i]=t.defaultProps[i]);return ke(t,u,a,_,null)}function ke(t,e,n,a,_){var i={type:t,props:e,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:_??++At,__i:-1,__u:0};return _==null&&w.vnode!=null&&w.vnode(i),i}function oe(t){return t.children}function we(t,e){this.props=t,this.context=e}function ne(t,e){if(e==null)return t.__?ne(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?ne(t):null}function Ft(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ft(t)}}function xt(t){(!t.__d&&(t.__d=!0)&&Z.push(t)&&!Se.__r++||Tt!=w.debounceRendering)&&((Tt=w.debounceRendering)||It)(Se)}function Se(){for(var t,e,n,a,_,i,u,p=1;Z.length;)Z.length>p&&Z.sort(Pt),t=Z.shift(),p=Z.length,t.__d&&(n=void 0,a=void 0,_=(a=(e=t).__v).__e,i=[],u=[],e.__P&&((n=q({},a)).__v=a.__v+1,w.vnode&&w.vnode(n),We(e.__P,n,a,e.__n,e.__P.namespaceURI,32&a.__u?[_]:null,i,_??ne(a),!!(32&a.__u),u),n.__v=a.__v,n.__.__k[n.__i]=n,Ut(i,n,u),a.__e=a.__=null,n.__e!=_&&Ft(n)));Se.__r=0}function Rt(t,e,n,a,_,i,u,p,c,d,v){var l,g,m,S,I,x,y,k=a&&a.__k||$t,F=e.length;for(c=Mn(n,e,k,c,F),l=0;l<F;l++)(m=n.__k[l])!=null&&(g=m.__i==-1?le:k[m.__i]||le,m.__i=l,x=We(t,m,g,_,i,u,p,c,d,v),S=m.__e,m.ref&&g.ref!=m.ref&&(g.ref&&qe(g.ref,null,m),v.push(m.ref,m.__c||S,m)),I==null&&S!=null&&(I=S),(y=!!(4&m.__u))||g.__k===m.__k?c=Ht(m,c,t,y):typeof m.type=="function"&&x!==void 0?c=x:S&&(c=S.nextSibling),m.__u&=-7);return n.__e=I,c}function Mn(t,e,n,a,_){var i,u,p,c,d,v=n.length,l=v,g=0;for(t.__k=new Array(_),i=0;i<_;i++)(u=e[i])!=null&&typeof u!="boolean"&&typeof u!="function"?(c=i+g,(u=t.__k[i]=typeof u=="string"||typeof u=="number"||typeof u=="bigint"||u.constructor==String?ke(null,u,null,null,null):Ce(u)?ke(oe,{children:u},null,null,null):u.constructor==null&&u.__b>0?ke(u.type,u.props,u.key,u.ref?u.ref:null,u.__v):u).__=t,u.__b=t.__b+1,p=null,(d=u.__i=Bn(u,n,c,l))!=-1&&(l--,(p=n[d])&&(p.__u|=2)),p==null||p.__v==null?(d==-1&&(_>v?g--:_<v&&g++),typeof u.type!="function"&&(u.__u|=4)):d!=c&&(d==c-1?g--:d==c+1?g++:(d>c?g--:g++,u.__u|=4))):t.__k[i]=null;if(l)for(i=0;i<v;i++)(p=n[i])!=null&&(2&p.__u)==0&&(p.__e==a&&(a=ne(p)),Mt(p,p));return a}function Ht(t,e,n,a){var _,i;if(typeof t.type=="function"){for(_=t.__k,i=0;_&&i<_.length;i++)_[i]&&(_[i].__=t,e=Ht(_[i],e,n,a));return e}t.__e!=e&&(a&&(e&&t.type&&!e.parentNode&&(e=ne(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Bn(t,e,n,a){var _,i,u,p=t.key,c=t.type,d=e[n],v=d!=null&&(2&d.__u)==0;if(d===null&&t.key==null||v&&p==d.key&&c==d.type)return n;if(a>(v?1:0)){for(_=n-1,i=n+1;_>=0||i<e.length;)if((d=e[u=_>=0?_--:i++])!=null&&(2&d.__u)==0&&p==d.key&&c==d.type)return u}return-1}function Et(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Un.test(e)?n:n+"px"}function ye(t,e,n,a,_){var i,u;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof a=="string"&&(t.style.cssText=a=""),a)for(e in a)n&&e in n||Et(t.style,e,"");if(n)for(e in n)a&&n[e]==a[e]||Et(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Lt,"$1")),u=e.toLowerCase(),e=u in t||e=="onFocusOut"||e=="onFocusIn"?u.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?a?n.u=a.u:(n.u=Be,t.addEventListener(e,i?je:Ue,i)):t.removeEventListener(e,i?je:Ue,i);else{if(_=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Dt(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Be++;else if(e.t<n.u)return;return n(w.event?w.event(e):e)}}}function We(t,e,n,a,_,i,u,p,c,d){var v,l,g,m,S,I,x,y,k,F,C,U,K,se,R,j,J,P=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),i=[p=e.__e=n.__e]),(v=w.__b)&&v(e);e:if(typeof P=="function")try{if(y=e.props,k="prototype"in P&&P.prototype.render,F=(v=P.contextType)&&a[v.__c],C=v?F?F.props.value:v.__:a,n.__c?x=(l=e.__c=n.__c).__=l.__E:(k?e.__c=l=new P(y,C):(e.__c=l=new we(y,C),l.constructor=P,l.render=Wn),F&&F.sub(l),l.props=y,l.state||(l.state={}),l.context=C,l.__n=a,g=l.__d=!0,l.__h=[],l._sb=[]),k&&l.__s==null&&(l.__s=l.state),k&&P.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=q({},l.__s)),q(l.__s,P.getDerivedStateFromProps(y,l.__s))),m=l.props,S=l.state,l.__v=e,g)k&&P.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),k&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(k&&P.getDerivedStateFromProps==null&&y!==m&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(y,C),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(y,l.__s,C)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(l.props=y,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(M){M&&(M.__=e)}),U=0;U<l._sb.length;U++)l.__h.push(l._sb[U]);l._sb=[],l.__h.length&&u.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(y,l.__s,C),k&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(m,S,I)})}if(l.context=C,l.props=y,l.__P=t,l.__e=!1,K=w.__r,se=0,k){for(l.state=l.__s,l.__d=!1,K&&K(e),v=l.render(l.props,l.state,l.context),R=0;R<l._sb.length;R++)l.__h.push(l._sb[R]);l._sb=[]}else do l.__d=!1,K&&K(e),v=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++se<25);l.state=l.__s,l.getChildContext!=null&&(a=q(q({},a),l.getChildContext())),k&&!g&&l.getSnapshotBeforeUpdate!=null&&(I=l.getSnapshotBeforeUpdate(m,S)),j=v,v!=null&&v.type===oe&&v.key==null&&(j=jt(v.props.children)),p=Rt(t,Ce(j)?j:[j],e,n,a,_,i,u,p,c,d),l.base=e.__e,e.__u&=-161,l.__h.length&&u.push(l),x&&(l.__E=l.__=null)}catch(M){if(e.__v=null,c||i!=null)if(M.then){for(e.__u|=c?160:128;p&&p.nodeType==8&&p.nextSibling;)p=p.nextSibling;i[i.indexOf(p)]=null,e.__e=p}else{for(J=i.length;J--;)Oe(i[J]);Me(e)}else e.__e=n.__e,e.__k=n.__k,M.then||Me(e);w.__e(M,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):p=e.__e=On(n.__e,e,n,a,_,i,u,c,d);return(v=w.diffed)&&v(e),128&e.__u?void 0:p}function Me(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Me)}function Ut(t,e,n){for(var a=0;a<n.length;a++)qe(n[a],n[++a],n[++a]);w.__c&&w.__c(e,t),t.some(function(_){try{t=_.__h,_.__h=[],t.some(function(i){i.call(_)})}catch(i){w.__e(i,_.__v)}})}function jt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Ce(t)?t.map(jt):q({},t)}function On(t,e,n,a,_,i,u,p,c){var d,v,l,g,m,S,I,x=n.props,y=e.props,k=e.type;if(k=="svg"?_="http://www.w3.org/2000/svg":k=="math"?_="http://www.w3.org/1998/Math/MathML":_||(_="http://www.w3.org/1999/xhtml"),i!=null){for(d=0;d<i.length;d++)if((m=i[d])&&"setAttribute"in m==!!k&&(k?m.localName==k:m.nodeType==3)){t=m,i[d]=null;break}}if(t==null){if(k==null)return document.createTextNode(y);t=document.createElementNS(_,k,y.is&&y),p&&(w.__m&&w.__m(e,i),p=!1),i=null}if(k==null)x===y||p&&t.data==y||(t.data=y);else{if(i=i&&Ne.call(t.childNodes),x=n.props||le,!p&&i!=null)for(x={},d=0;d<t.attributes.length;d++)x[(m=t.attributes[d]).name]=m.value;for(d in x)if(m=x[d],d!="children"){if(d=="dangerouslySetInnerHTML")l=m;else if(!(d in y)){if(d=="value"&&"defaultValue"in y||d=="checked"&&"defaultChecked"in y)continue;ye(t,d,null,m,_)}}for(d in y)m=y[d],d=="children"?g=m:d=="dangerouslySetInnerHTML"?v=m:d=="value"?S=m:d=="checked"?I=m:p&&typeof m!="function"||x[d]===m||ye(t,d,m,x[d],_);if(v)p||l&&(v.__html==l.__html||v.__html==t.innerHTML)||(t.innerHTML=v.__html),e.__k=[];else if(l&&(t.innerHTML=""),Rt(e.type=="template"?t.content:t,Ce(g)?g:[g],e,n,a,k=="foreignObject"?"http://www.w3.org/1999/xhtml":_,i,u,i?i[0]:n.__k&&ne(n,0),p,c),i!=null)for(d=i.length;d--;)Oe(i[d]);p||(d="value",k=="progress"&&S==null?t.removeAttribute("value"):S!=null&&(S!==t[d]||k=="progress"&&!S||k=="option"&&S!=x[d])&&ye(t,d,S,x[d],_),d="checked",I!=null&&I!=t[d]&&ye(t,d,I,x[d],_))}return t}function qe(t,e,n){try{if(typeof t=="function"){var a=typeof t.__u=="function";a&&t.__u(),a&&e==null||(t.__u=t(e))}else t.current=e}catch(_){w.__e(_,n)}}function Mt(t,e,n){var a,_;if(w.unmount&&w.unmount(t),(a=t.ref)&&(a.current&&a.current!=t.__e||qe(a,null,e)),(a=t.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(i){w.__e(i,e)}a.base=a.__P=null}if(a=t.__k)for(_=0;_<a.length;_++)a[_]&&Mt(a[_],e,n||typeof t.type!="function");n||Oe(t.__e),t.__c=t.__=t.__e=void 0}function Wn(t,e,n){return this.constructor(t,n)}function Bt(t,e,n){var a,_,i,u;e==document&&(e=document.documentElement),w.__&&w.__(t,e),_=(a=typeof n=="function")?null:n&&n.__k||e.__k,i=[],u=[],We(e,t=(!a&&n||e).__k=jn(oe,null,[t]),_||le,le,e.namespaceURI,!a&&n?[n]:_?null:e.firstChild?Ne.call(e.childNodes):null,i,!a&&n?n:_?_.__e:e.firstChild,a,u),Ut(i,t,u)}Ne=$t.slice,w={__e:function(t,e,n,a){for(var _,i,u;e=e.__;)if((_=e.__c)&&!_.__)try{if((i=_.constructor)&&i.getDerivedStateFromError!=null&&(_.setState(i.getDerivedStateFromError(t)),u=_.__d),_.componentDidCatch!=null&&(_.componentDidCatch(t,a||{}),u=_.__d),u)return _.__E=_}catch(p){t=p}throw t}},At=0,Rn=function(t){return t!=null&&t.constructor==null},we.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=q({},this.state),typeof t=="function"&&(t=t(q({},n),this.props)),t&&q(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),xt(this))},we.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),xt(this))},we.prototype.render=oe,Z=[],It=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pt=function(t,e){return t.__v.__b-e.__v.__b},Se.__r=0,Lt=/(PointerCapture)$|Capture$/i,Be=0,Ue=Dt(!1),je=Dt(!0),Hn=0;var ce,T,Ke,Ot,xe=0,Jt=[],E=w,Wt=E.__b,qt=E.__r,Kt=E.diffed,Vt=E.__c,Gt=E.unmount,zt=E.__;function Ge(t,e){E.__h&&E.__h(T,t,xe||e),xe=0;var n=T.__H||(T.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function b(t){return xe=1,qn(Xt,t)}function qn(t,e,n){var a=Ge(ce++,2);if(a.t=t,!a.__c&&(a.__=[n?n(e):Xt(void 0,e),function(p){var c=a.__N?a.__N[0]:a.__[0],d=a.t(c,p);c!==d&&(a.__N=[d,a.__[1]],a.__c.setState({}))}],a.__c=T,!T.__f)){var _=function(p,c,d){if(!a.__c.__H)return!0;var v=a.__c.__H.__.filter(function(g){return!!g.__c});if(v.every(function(g){return!g.__N}))return!i||i.call(this,p,c,d);var l=a.__c.props!==p;return v.forEach(function(g){if(g.__N){var m=g.__[0];g.__=g.__N,g.__N=void 0,m!==g.__[0]&&(l=!0)}}),i&&i.call(this,p,c,d)||l};T.__f=!0;var i=T.shouldComponentUpdate,u=T.componentWillUpdate;T.componentWillUpdate=function(p,c,d){if(this.__e){var v=i;i=void 0,_(p,c,d),i=v}u&&u.call(this,p,c,d)},T.shouldComponentUpdate=_}return a.__N||a.__}function $(t,e){var n=Ge(ce++,3);!E.__s&&Qt(n.__H,e)&&(n.__=t,n.u=e,T.__H.__h.push(n))}function Yt(t){return xe=5,Ee(function(){return{current:t}},[])}function Ee(t,e){var n=Ge(ce++,7);return Qt(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Kn(){for(var t;t=Jt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Te),t.__H.__h.forEach(Ve),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){T=null,Wt&&Wt(t)},E.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),zt&&zt(t,e)},E.__r=function(t){qt&&qt(t),ce=0;var e=(T=t.__c).__H;e&&(Ke===T?(e.__h=[],T.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Te),e.__h.forEach(Ve),e.__h=[],ce=0)),Ke=T},E.diffed=function(t){Kt&&Kt(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Jt.push(e)!==1&&Ot===E.requestAnimationFrame||((Ot=E.requestAnimationFrame)||Vn)(Kn)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ke=T=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Te),n.__h=n.__h.filter(function(a){return!a.__||Ve(a)})}catch(a){e.some(function(_){_.__h&&(_.__h=[])}),e=[],E.__e(a,n.__v)}}),Vt&&Vt(t,e)},E.unmount=function(t){Gt&&Gt(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(a){try{Te(a)}catch(_){e=_}}),n.__H=void 0,e&&E.__e(e,n.__v))};var Zt=typeof requestAnimationFrame=="function";function Vn(t){var e,n=function(){clearTimeout(a),Zt&&cancelAnimationFrame(e),setTimeout(t)},a=setTimeout(n,35);Zt&&(e=requestAnimationFrame(n))}function Te(t){var e=T,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),T=e}function Ve(t){var e=T;t.__c=t.__(),T=e}function Qt(t,e){return!t||t.length!==e.length||e.some(function(n,a){return n!==t[a]})}function Xt(t,e){return typeof e=="function"?e(t):e}function Gn(){let t=localStorage.getItem("grns_api_token");return t?{Authorization:`Bearer ${t}`}:{}}async function H(t,e,n){let a={...Gn()},_={method:t,headers:a,credentials:"same-origin"};n!==void 0&&(a["Content-Type"]="application/json",_.body=JSON.stringify(n));let i=await fetch(`${e}`,_);if(!i.ok){let u=await i.json().catch(()=>({})),p=u.error||i.statusText,c=new Error(p);throw c.status=i.status,c.code=u.code,c.errorCode=u.error_code,c}return i.status===204?null:i.json()}function en(){return H("GET","/v1/info")}function tn(){return H("GET","/v1/auth/me")}function nn(t,e){return H("POST","/v1/auth/login",{username:t,password:e})}function on(){return H("POST","/v1/auth/logout")}function ze(t,e={}){let n=new URLSearchParams(e);return H("GET",`/v1/projects/${encodeURIComponent(t)}/tasks?${n.toString()}`)}function Ze(t,e){return H("GET",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}`)}function sn(t,e,n){return H("PATCH",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}`,n)}function Je(t,e,n){return H("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}/labels`,{labels:n})}function rn(t,e,n){return H("DELETE",`/v1/projects/${encodeURIComponent(t)}/tasks/${encodeURIComponent(e)}/labels`,{labels:n})}function Ye(t,e){return H("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/close`,{ids:e})}function Qe(t,e){return H("POST",`/v1/projects/${encodeURIComponent(t)}/tasks/reopen`,{ids:e})}var zn=0,_o=Array.isArray;function o(t,e,n,a,_,i){e||(e={});var u,p,c=e;if("ref"in c)for(p in c={},e)p=="ref"?u=e[p]:c[p]=e[p];var d={type:t,props:c,key:n,ref:u,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--zn,__i:-1,__u:0,__source:_,__self:i};if(typeof t=="function"&&(u=t.defaultProps))for(p in u)c[p]===void 0&&(c[p]=u[p]);return w.vnode&&w.vnode(d),d}var ue=["open","in_progress","blocked","deferred","pinned","closed","tombstone"],Zn=["bug","feature","task","epic","chore"],Jn=[0,1,2,3,4],an=["open","in_progress","blocked","deferred","pinned"],Yn=[20,50,100],ln=50;function Qn(t){let e=t||"#/";e.startsWith("#")&&(e=e.slice(1)),e.startsWith("/")||(e=`/${e}`);let[n,a=""]=e.split("?");return{path:n||"/",params:new URLSearchParams(a)}}function De(t,e){let n=e.toString();return`#${t}${n?`?${n}`:""}`}function Xe(t){let e=new Set(t);return ue.filter(n=>e.has(n))}function Xn(t){let e=(t.get("search")||"").trim(),n=(t.get("status")||"").split(",").map(c=>c.trim()).filter(Boolean),a=Xe(n),_=Number.parseInt(t.get("limit")||"",10),i=Number.isFinite(_)&&_>0?_:ln,u=Number.parseInt(t.get("offset")||"",10),p=Number.isFinite(u)&&u>=0?u:0;return{search:e,statuses:a.length>0?a:an,limit:i,offset:p}}function eo(t){return t.startsWith("/tasks/")?t.slice(7).split("/")[0].trim():""}function to(){let[t,e]=b(window.location.hash||"#/");return $(()=>{let n=()=>e(window.location.hash||"#/");return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),t}function no(t,e){let[n,a]=b(t);return $(()=>{let _=window.setTimeout(()=>a(t),e);return()=>window.clearTimeout(_)},[t,e]),n}function Ae(t){if(!t)return"\u2014";let e=new Date(t);return Number.isNaN(e.getTime())?t:e.toISOString().slice(0,19)+"Z"}function oo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}function so(t){return t instanceof Element?!!t.closest('input, textarea, select, button, [contenteditable="true"]'):!1}function et(){let t=to(),e=Ee(()=>Qn(t),[t]),n=Ee(()=>Xn(e.params),[e]),a=no(n.search,300),[_,i]=b(null),[u,p]=b([]),[c,d]=b(null),[v,l]=b(!1),[g,m]=b(!1),[S,I]=b(null),[x,y]=b(0),[k,F]=b(!0),[C,U]=b(!1),[K,se]=b(!1),[R,j]=b(""),[J,P]=b(""),[M,tt]=b(""),[nt,_e]=b(""),[D,ot]=b(""),[st,rt]=b(""),[at,Ie]=b(""),[cn,Pe]=b(""),[it,de]=b(""),[B,Y]=b([]),[lt,ct]=b(""),[ut,V]=b(""),[_t,G]=b(""),[O,Q]=b(!1),[fe,X]=b(0),[pe,z]=b(!1),[dt,un]=b(""),[Le,ft]=b(""),[pt,he]=b(""),[me,ht]=b(!1),ve=Yt(null),N=(e.params.get("project")||"").trim()||_?.project_prefix||"",W=e.path==="/",re=eo(e.path),$e=re!=="",ge=!g||!!S?.authenticated;$(()=>{let s=!0;async function r(){l(!1),he("");try{let f=await tn();if(!s)return;let h=!!f?.auth_required,A=!!f?.authenticated;m(h),I(A?f:null)}catch(f){if(!s)return;f?.status===401?(m(!0),I(null)):(j(f.message||"Failed to load auth state"),m(!1),I(null))}finally{s&&l(!0)}}return r(),()=>{s=!1}},[x]),$(()=>{let s=!0;async function r(){if(v){if(g&&!S?.authenticated){F(!1),i(null);return}F(!0),j("");try{let f=await en();if(!s)return;i(f)}catch(f){if(!s)return;j(f.message||"Failed to load server info")}finally{s&&F(!1)}}}return r(),()=>{s=!1}},[v,g,S?.authenticated]);function mt(){let s={limit:String(n.limit),offset:String(n.offset),status:n.statuses.join(",")};return a&&(s.search=a),s}async function Fe(){if(!W||!N)return!1;U(!0),P("");try{let s=await ze(N,mt());return p(s),!0}catch(s){return P(s.message||"Failed to load tasks"),!1}finally{U(!1)}}async function _n(s){s.preventDefault();let r=dt.trim();if(!r||!Le){he("Username and password are required.");return}ht(!0),he("");try{await nn(r,Le),ft(""),y(f=>f+1)}catch(f){he(f.message||"Login failed")}finally{ht(!1)}}async function vt(){try{await on()}catch{}try{localStorage.removeItem("grns_api_token")}catch{}p([]),d(null),y(s=>s+1)}$(()=>{if(!ge||!W||!N)return;let s=!0;return U(!0),P(""),ze(N,mt()).then(r=>{s&&p(r)}).catch(r=>{s&&P(r.message||"Failed to load tasks")}).finally(()=>{s&&U(!1)}),()=>{s=!1}},[ge,N,W,n.limit,n.offset,n.statuses,a]),$(()=>{let s=!0;async function r(){if(!ge||!$e||!N){d(null);return}se(!0),tt(""),_e("");try{let f=await Ze(N,re);if(!s)return;d(f)}catch(f){if(!s)return;d(null),tt(f.message||"Failed to load task")}finally{s&&se(!1)}}return r(),()=>{s=!1}},[ge,N,$e,re]),$(()=>{Y(s=>{let r=new Set(u.map(f=>f.id));return s.filter(f=>r.has(f))}),X(s=>u.length===0?0:Math.min(s,u.length-1))},[u]),$(()=>{rt(c?.assignee||"")},[c?.id,c?.assignee]),$(()=>{Ie("")},[c?.id]),$(()=>{Pe(""),de("")},[c?.id]),$(()=>{W||z(!1)},[W]);function ae(s){if(!W)return;let r=new URLSearchParams(e.params),f=(s.search||"").trim();f?r.set("search",f):r.delete("search");let h=Xe(s.statuses);h.length>0&&!oo(h,an)?r.set("status",h.join(",")):r.delete("status"),s.limit>0&&s.limit!==ln?r.set("limit",String(s.limit)):r.delete("limit"),s.offset>0?r.set("offset",String(s.offset)):r.delete("offset");let A=De("/",r);window.location.hash!==A&&(window.location.hash=A)}function dn(s){let r=n.statuses.includes(s)?n.statuses.filter(h=>h!==s):[...n.statuses,s],f=Xe(r);ae({...n,statuses:f.length>0?f:ue,offset:0})}function fn(s){ae({...n,search:s.currentTarget.value,offset:0})}function pn(s){let r=Number.parseInt(s.currentTarget.value,10);!Number.isFinite(r)||r<=0||ae({...n,limit:r,offset:0})}function hn(){ae({...n,offset:Math.max(0,n.offset-n.limit)})}function mn(){ae({...n,offset:n.offset+n.limit})}function vn(){if(u.length===0)return;let s=Math.min(fe,u.length-1),r=u[s]?.id;if(!r)return;let f=De(`/tasks/${r}`,e.params);window.location.hash!==f&&(window.location.hash=f)}function gt(s){Y(r=>{let f=new Set(r);return f.has(s)?f.delete(s):f.add(s),Array.from(f)})}function bt(){let s=u.map(h=>h.id);if(s.length===0)return;let r=new Set(B),f=s.every(h=>r.has(h));Y(h=>{let A=new Set(h);return f?s.forEach(L=>A.delete(L)):s.forEach(L=>A.add(L)),Array.from(A)})}function gn(){Y([])}async function bn(){if(!N||B.length===0)return;let s=[...B];Q(!0),V(""),G("");try{await Ye(N,s);let r=await Fe();Y([]),G(r?`Closed ${s.length} task(s).`:`Closed ${s.length} task(s), but refresh failed.`)}catch(r){V(r.message||"Failed to close selected tasks")}finally{Q(!1)}}async function yn(){if(!N||B.length===0)return;let s=[...B];Q(!0),V(""),G("");try{await Qe(N,s);let r=await Fe();Y([]),G(r?`Reopened ${s.length} task(s).`:`Reopened ${s.length} task(s), but refresh failed.`)}catch(r){V(r.message||"Failed to reopen selected tasks")}finally{Q(!1)}}async function yt(){if(!N||B.length===0)return;let s=St(lt);if(s.length===0)return;let r=[...B];Q(!0),V(""),G("");try{let f=await Promise.allSettled(r.map(L=>Je(N,L,s))),h=f.filter(L=>L.status==="fulfilled").length,A=f.length-h;if(h>0){let L=await Fe();ct(""),G(L?`Added label(s) to ${h}/${r.length} task(s).`:`Added label(s) to ${h}/${r.length} task(s), but refresh failed.`)}else G(`Added label(s) to ${h}/${r.length} task(s).`);if(A>0){let L=f.find(Fn=>Fn.status==="rejected"),$n=L&&L.reason?String(L.reason.message||L.reason):"unknown error";V(`Failed on ${A} task(s): ${$n}`)}}catch(f){V(f.message||"Failed to add labels to selected tasks")}finally{Q(!1)}}async function ie(s,r,f){_e(""),ot(s);try{return await r()}catch(h){return _e(h.message||f||`Failed to update ${s}`),null}finally{ot("")}}async function kt(){if(!N||!re)return null;let s=await Ze(N,re);return d(s),s}async function ee(s,r){if(!N||!c||!c.id)return!1;let f=await ie(s,()=>sn(N,c.id,r),`Failed to update ${s}`);return f?(d(f),!0):!1}function kn(s){let r=s.currentTarget.value;!c||r===c.status||ee("status",{status:r})}function wn(s){let r=s.currentTarget.value;!c||r===c.type||ee("type",{type:r})}function Sn(s){let r=Number.parseInt(s.currentTarget.value,10);!c||!Number.isFinite(r)||r===c.priority||ee("priority",{priority:r})}function wt(){if(!c)return;let s=st.trim(),r=(c.assignee||"").trim();s!==r&&ee("assignee",{assignee:s})}function St(s){let r=s.split(",").map(f=>f.trim().toLowerCase()).filter(Boolean);return Array.from(new Set(r))}async function Nt(){if(!c||!c.id)return;let s=St(at);if(s.length===0)return;let r=await ie("labels",()=>Je(N,c.id,s),"Failed to add labels");r&&(d(f=>f&&{...f,labels:r}),Ie(""))}async function Nn(s){if(!c||!c.id)return;let r=await ie("labels",()=>rn(N,c.id,[s]),"Failed to remove label");r&&d(f=>f&&{...f,labels:r})}async function Cn(){if(!c||!c.id)return;await ie("close",()=>Ye(N,[c.id]),"Failed to close task")&&await kt()}async function Tn(){if(!c||!c.id)return;await ie("reopen",()=>Qe(N,[c.id]),"Failed to reopen task")&&await kt()}function xn(){c&&c.status!=="tombstone"&&ee("status",{status:"tombstone"})}function En(s){c&&(_e(""),Pe(s),de(c[s]||""))}function Re(){Pe(""),de("")}async function Dn(s){if(!c)return;let r=it,f=c[s]||"";if(r===f){Re();return}await ee(s,{[s]:r})&&Re()}function be(s,r){if(!c)return null;let f=cn===r,h=c[r]||"";return o("div",{className:"detail-section",children:[o("div",{className:"detail-section-header",children:[o("h3",{children:s}),f?o("div",{className:"inline-actions",children:[o("button",{type:"button",onClick:()=>Dn(r),disabled:D!=="",children:"Save"}),o("button",{type:"button",onClick:Re,disabled:D!=="",children:"Cancel"})]}):o("button",{type:"button",className:"detail-edit-btn",onClick:()=>En(r),disabled:D!=="",children:"Edit"})]}),f?o("textarea",{className:"detail-textarea",value:it,onInput:A=>de(A.currentTarget.value),rows:6,disabled:D!==""}):o("pre",{children:h||"\u2014"})]})}$(()=>{if(!W)return;function s(r){if(!(r.defaultPrevented||r.metaKey||r.ctrlKey||r.altKey)){if(r.key==="Escape"&&pe){r.preventDefault(),z(!1);return}if(!so(r.target)){if(r.key==="?"||r.shiftKey&&r.key==="/"){r.preventDefault(),z(f=>!f);return}if(r.key==="/"&&!r.shiftKey){r.preventDefault(),ve.current&&(ve.current.focus(),ve.current.select());return}if(!pe&&!(C||O)){if(r.shiftKey&&r.key.toLowerCase()==="a"){r.preventDefault(),bt();return}if(!r.shiftKey&&(r.key==="x"||r.key==="X")){if(r.preventDefault(),u.length===0)return;let f=Math.min(fe,u.length-1),h=u[f]?.id||u[0]?.id;h&&gt(h);return}if(r.key==="Enter"){r.preventDefault(),vn();return}if(r.key==="ArrowDown"||r.key==="j"){if(r.preventDefault(),u.length===0)return;X(f=>Math.min(f+1,u.length-1));return}if(r.key==="ArrowUp"||r.key==="k"){if(r.preventDefault(),u.length===0)return;X(f=>Math.max(f-1,0))}}}}}return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[W,u,fe,C,O,pe,e.params]);let An=Math.floor(n.offset/n.limit)+1,In=n.offset>0,Pn=u.length===n.limit,He=new Set(B),te=B.length,Ln=u.length>0&&u.every(s=>He.has(s.id)),Ct=ue.map(s=>({status:s,count:u.reduce((r,f)=>He.has(f.id)&&f.status===s?r+1:r,0)})).filter(s=>s.count>0);if(!v)return o("main",{className:"container",children:[o("h1",{children:"grns web ui"}),o("div",{className:"meta",children:"Checking authentication\u2026"})]});if(g&&!S?.authenticated)return o("main",{className:"container",children:[o("header",{className:"header",children:[o("h1",{children:"grns sign in"}),o("div",{className:"meta",children:"Sign in with a provisioned admin user."})]}),o("form",{className:"detail-card",onSubmit:_n,children:[o("div",{className:"detail-section",children:o("label",{children:["Username",o("input",{type:"text",autoComplete:"username",value:dt,onInput:s=>un(s.currentTarget.value),disabled:me})]})}),o("div",{className:"detail-section",children:o("label",{children:["Password",o("input",{type:"password",autoComplete:"current-password",value:Le,onInput:s=>ft(s.currentTarget.value),disabled:me})]})}),o("div",{className:"action-row",children:o("button",{type:"submit",disabled:me,children:me?"Signing in\u2026":"Sign in"})})]}),pt&&o("div",{className:"error",children:pt}),R&&o("div",{className:"error",children:R})]});if($e){let s=c?.labels||[],r=c?.deps||[],f=De("/",e.params);return o("main",{className:"container",children:[o("header",{className:"header",children:[o("h1",{children:"Task detail"}),o("div",{className:"meta",children:k?"Loading server info\u2026":`project: ${N||"\u2014"}`}),S?.authenticated&&o("button",{type:"button",onClick:vt,children:"Sign out"})]}),o("a",{className:"back-link",href:f,children:"\u2190 Back to task list"}),K&&o("div",{className:"meta",children:"Loading task\u2026"}),!K&&c&&o("section",{className:"detail-card",children:[o("h2",{children:c.title}),o("div",{className:"detail-id mono",children:c.id}),D&&o("div",{className:"meta",children:["Saving ",D,"\u2026"]}),o("div",{className:"detail-grid",children:[o("div",{children:[o("strong",{children:"Status:"})," ",o("select",{value:c.status,onChange:kn,disabled:D!=="",children:ue.map(h=>o("option",{value:h,children:h},h))})]}),o("div",{children:[o("strong",{children:"Type:"})," ",o("select",{value:c.type,onChange:wn,disabled:D!=="",children:Zn.map(h=>o("option",{value:h,children:h},h))})]}),o("div",{children:[o("strong",{children:"Priority:"})," ",o("select",{value:String(c.priority),onChange:Sn,disabled:D!=="",children:Jn.map(h=>o("option",{value:String(h),children:h},h))})]}),o("div",{className:"assignee-edit",children:[o("strong",{children:"Assignee:"})," ",o("input",{type:"text",value:st,onInput:h=>rt(h.currentTarget.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),wt())},placeholder:"unassigned",disabled:D!==""}),o("button",{type:"button",onClick:wt,disabled:D!=="",children:"Save"})]}),o("div",{children:[o("strong",{children:"Parent:"})," ",c.parent_id?o("a",{href:`#/tasks/${c.parent_id}`,children:c.parent_id}):"\u2014"]}),o("div",{children:[o("strong",{children:"Spec:"})," ",c.spec_id||"\u2014"]}),o("div",{children:[o("strong",{children:"Created:"})," ",o("span",{className:"mono small",children:Ae(c.created_at)})]}),o("div",{children:[o("strong",{children:"Updated:"})," ",o("span",{className:"mono small",children:Ae(c.updated_at)})]}),o("div",{children:[o("strong",{children:"Closed:"})," ",o("span",{className:"mono small",children:Ae(c.closed_at)})]})]}),o("div",{className:"detail-section",children:[o("div",{className:"detail-section-header",children:o("h3",{children:"Labels"})}),s.length===0?o("div",{className:"meta",children:"No labels."}):o("div",{className:"label-row",children:s.map(h=>o("span",{className:"label-chip",children:[h,o("button",{type:"button",className:"label-remove-btn",onClick:()=>Nn(h),disabled:D!=="","aria-label":`Remove label ${h}`,children:"\xD7"})]},h))}),o("div",{className:"label-add-row",children:[o("input",{type:"text",value:at,onInput:h=>Ie(h.currentTarget.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),Nt())},placeholder:"add labels (comma-separated)",disabled:D!==""}),o("button",{type:"button",onClick:Nt,disabled:D!=="",children:"Add"})]})]}),be("Description","description"),be("Notes","notes"),be("Acceptance criteria","acceptance_criteria"),be("Design","design"),o("div",{className:"detail-section",children:[o("h3",{children:"Dependencies"}),r.length===0?o("div",{className:"meta",children:"No direct dependencies."}):o("ul",{className:"dep-list",children:r.map(h=>o("li",{children:[o("a",{href:`#/tasks/${h.parent_id}`,children:h.parent_id})," ",o("span",{className:"meta",children:["(",h.type,")"]})]},`${h.parent_id}-${h.type}`))})]}),o("div",{className:"detail-section",children:[o("h3",{children:"Actions"}),o("div",{className:"action-row",children:[o("button",{type:"button",onClick:Cn,disabled:D!==""||c.status==="closed"||c.status==="tombstone",children:"Close"}),o("button",{type:"button",onClick:Tn,disabled:D!==""||c.status!=="closed"&&c.status!=="tombstone",children:"Reopen"}),o("button",{type:"button",onClick:xn,disabled:D!==""||c.status==="tombstone",children:"Mark tombstone"})]})]})]}),nt&&o("div",{className:"error",children:nt}),M&&o("div",{className:"error",children:M}),R&&o("div",{className:"error",children:R})]})}return W?o("main",{className:"container",children:[o("header",{className:"header",children:[o("h1",{children:"Task list"}),o("div",{className:"meta",children:k?"Loading server info\u2026":`project: ${N||"\u2014"} \xB7 schema: ${_?.schema_version??"\u2014"}`}),S?.authenticated&&o("button",{type:"button",onClick:vt,children:"Sign out"})]}),o("section",{className:"controls",children:[o("label",{className:"search",children:[o("span",{children:"Search"}),o("input",{ref:ve,type:"search",value:n.search,onInput:fn,placeholder:"Search title/description/notes"})]}),o("div",{className:"status-row",children:ue.map(s=>{let r=n.statuses.includes(s);return o("button",{type:"button",className:`status-chip ${r?"active":""}`,onClick:()=>dn(s),children:s},s)})})]}),o("section",{className:"list-meta",children:[o("div",{children:[C?"Loading tasks\u2026":`Showing ${u.length} task(s)`,a&&o("span",{children:[" \xB7 search: \u201C",a,"\u201D"]})]}),o("label",{children:["Page size",o("select",{value:String(n.limit),onChange:pn,children:Yn.map(s=>o("option",{value:String(s),children:s},s))})]})]}),o("section",{className:"bulk-actions",children:[o("div",{className:"bulk-summary-row",children:[o("div",{className:"bulk-summary",children:["Selected: ",te]}),o("div",{className:"bulk-summary-actions",children:[o("button",{type:"button",onClick:()=>z(!0),children:"Shortcuts (?)"}),o("button",{type:"button",onClick:gn,disabled:te===0||O||C,children:"Clear selection"})]})]}),o("div",{className:"bulk-shortcuts",children:"Shortcuts: ? help \xB7 / search \xB7 Enter open active \xB7 x toggle active \xB7 Shift+A select visible \xB7 j/k move active"}),Ct.length>0&&o("div",{className:"bulk-status-counts",children:Ct.map(s=>o("span",{className:"bulk-status-chip",children:[s.status,": ",s.count]},s.status))}),o("div",{className:"bulk-controls",children:[o("button",{type:"button",onClick:bn,disabled:te===0||O||C,children:"Close selected"}),o("button",{type:"button",onClick:yn,disabled:te===0||O||C,children:"Reopen selected"}),o("input",{type:"text",value:lt,onInput:s=>ct(s.currentTarget.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),yt())},placeholder:"labels for selected (comma-separated)",disabled:te===0||O||C}),o("button",{type:"button",onClick:yt,disabled:te===0||O||C,children:"Add labels"})]})]}),o("section",{children:o("table",{className:"task-table",children:[o("thead",{children:o("tr",{children:[o("th",{children:o("input",{type:"checkbox",checked:Ln,onChange:bt,"aria-label":"Select all visible tasks",disabled:u.length===0||C||O})}),o("th",{children:"ID"}),o("th",{children:"Title"}),o("th",{children:"Status"}),o("th",{children:"Priority"}),o("th",{children:"Type"}),o("th",{children:"Updated"})]})}),o("tbody",{children:[u.map((s,r)=>{let f=De(`/tasks/${s.id}`,e.params);return o("tr",{className:r===fe?"row-active":"",onClick:()=>X(r),children:[o("td",{children:o("input",{type:"checkbox",checked:He.has(s.id),onChange:()=>{X(r),gt(s.id)},onClick:A=>A.stopPropagation(),"aria-label":`Select task ${s.id}`,disabled:C||O})}),o("td",{className:"mono",children:s.id}),o("td",{children:o("a",{href:f,onClick:A=>{A.stopPropagation(),X(r)},children:s.title})}),o("td",{children:s.status}),o("td",{children:s.priority}),o("td",{children:s.type}),o("td",{className:"mono small",children:Ae(s.updated_at)})]},s.id)}),!C&&u.length===0&&o("tr",{children:o("td",{colSpan:7,className:"empty",children:"No tasks found for current filters."})})]})]})}),o("section",{className:"pagination",children:[o("button",{type:"button",onClick:hn,disabled:!In||C,children:"\u2190 Prev"}),o("span",{children:["Page ",An]}),o("button",{type:"button",onClick:mn,disabled:!Pn||C,children:"Next \u2192"})]}),pe&&o("div",{className:"shortcut-overlay",onClick:()=>z(!1),role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Escape"||s.key==="Enter"||s.key===" ")&&(s.preventDefault(),z(!1))},children:o("div",{className:"shortcut-modal",onClick:s=>s.stopPropagation(),children:[o("div",{className:"shortcut-modal-header",children:[o("h3",{children:"Keyboard shortcuts"}),o("button",{type:"button",onClick:()=>z(!1),children:"Close"})]}),o("ul",{children:[o("li",{children:[o("kbd",{children:"?"})," toggle shortcut help"]}),o("li",{children:[o("kbd",{children:"/"})," focus search"]}),o("li",{children:[o("kbd",{children:"Enter"})," open active row"]}),o("li",{children:[o("kbd",{children:"j"}),"/",o("kbd",{children:"k"})," or ",o("kbd",{children:"\u2193"}),"/",o("kbd",{children:"\u2191"})," move active row"]}),o("li",{children:[o("kbd",{children:"x"})," toggle selection for active row"]}),o("li",{children:[o("kbd",{children:"Shift"}),"+",o("kbd",{children:"A"})," select/unselect all visible"]}),o("li",{children:[o("kbd",{children:"Esc"})," close this dialog"]})]})]})}),_t&&o("div",{className:"meta",children:_t}),ut&&o("div",{className:"error",children:ut}),J&&o("div",{className:"error",children:J}),R&&o("div",{className:"error",children:R})]}):o("main",{className:"container",children:[o("h1",{children:"grns web ui"}),o("div",{className:"meta",children:["Route scaffold active: ",e.path]}),o("a",{href:"#/",children:"Back to task list"})]})}Bt(o(et,{}),document.getElementById("app"));
